import"reflect-metadata";import n from"hoist-non-react-statics";import{__extends as t,__awaiter as r,__generator as i}from"tslib";import{createDraft as o,finishDraft as u,immerable as e}from"immer";export{original,enableES5,enableMapSet}from"immer";import{Component as f,createContext as c,createElement as s,useContext as a,useRef as v,useCallback as l}from"react";function h(n){return"function"==typeof n}function d(n){return n&&"object"==typeof n}var m="function"==typeof Symbol?Symbol():"__injector__",b=c({}),y=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return t(r,n),r}(f);function _(n){var t,r=n[m];return r||((r=p||(null===(t=n.context)||void 0===t?void 0:t.injector))instanceof y?(n[m]=r,r):void 0)}var p=null;function S(n,t){for(j.length>0&&(j.forEach(function(n){n()}),j.length=0);n;){var r=n.t.get(t);if(void 0!==r)return r;var i=n.i.get(t);if(i){var o=p;p=n;try{r=i(n)}finally{p=o}return n.t.set(t,r),n.o(r),r}n=n.u}}var j=[];function w(n,t){if(h(t))return g(n,t);var r=n;return t?i(r,t):i;function i(n,t){n.constructor.contextType=b,r||(r=Reflect.getMetadata("design:type",n,t));var i={configurable:!0,enumerable:!0,get:function(){var n=g(this,r);return Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n}),n},set:function(n){Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n})}};return Object.defineProperty(n,t,i),i}}function g(n,t){return S(_(n),t)}var M="function"==typeof Symbol?Symbol():"__binding__";function O(n){return A(function(t){var r=new n;return r[m]||(r[m]=t),r})}function x(n,t){return A(t?function(r){return t.apply(void 0,n.map(function(n){return S(r,n)}))}:n)}function I(n){return A(function(){return n})}function R(n){return A(function(t){return S(t,n)})}function A(n){return n[M]=!0,n}function E(n,t){t.forEach(function(t){var r,i,o;Array.isArray(t)?(i=t[0],o=void 0===(r=t[1])?i:r):i=o=t,n.set(i,o[M]?o:O(o))})}var P="function"==typeof Symbol?Symbol():"__init__",k=function(){return function(){}}(),q=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return function(i){var o=new Map;E(o,r);var u=function(n){function r(){var t,r=n.apply(this,arguments)||this;return r.u=null===(t=r.context)||void 0===t?void 0:t.injector,r.i=o,r.t=new Map,r}return t(r,n),r.prototype.o=function(n){var t=this;n instanceof k&&!n[P]&&(n.initProvider(function(){return t.setState({injector:t})}),n[P]=!0)},r.prototype.componentDidMount=function(){var n=this;this.t.forEach(function(t){n.o(t)})},r.prototype.componentWillUnmount=function(){this.t.forEach(function(n){d(n)&&h(n.dispose)&&n.dispose()})},r.prototype.render=function(){return s(b.Provider,{value:{injector:this}},s(i,this.props))},r.register=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];E(o,n)},r.WrappedComponent=i,r}(y);return u.contextType=b,n(u,i)}},z=function(n,t){return function(r){return j.push(function(){n().register(t?[r,t]:r)}),r}};function B(n){var t,r=v(void 0),i=null===(t=a(b))||void 0===t?void 0:t.injector;return r.current||(r.current=S(i,n))}function C(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=v(null),o=null===(n=a(b))||void 0===n?void 0:n.injector;return i.current||(i.current=t.map(function(n){return S(o,n)}))}var D="function"==typeof Symbol?Symbol():"__store__",F="function"==typeof Symbol?Symbol():"__stores__",G="function"==typeof Symbol?Symbol():"__refresh__",H=function(){function n(n){this.count=0,this.service=n}return n.prototype.start=function(n){var t,r=this;if(void 0===n&&(n=!0),0==this.count){var i=this.draft=null!==(t=this.draft)&&void 0!==t?t:o(this.service);this.service[F].forEach(function(n){r.service[n]=i[n]})}n&&this.count++},n.prototype.finish=function(n,t){var r=this;if(void 0===n&&(n=!0),void 0===t&&(t=!0),0==this.count)console.warn("the finish method must be called after corresponding start method");else if(t&&this.count--,0==this.count){var i=this.draft;if(i){this.service[F].forEach(function(n){i[n]=r.service[n]});var o=u(i);this.service[F].forEach(function(n){r.service[n]=o[n]}),this.draft=void 0}}n&&this.service.RefreshContext()},n}(),J=function(n){function o(){var t,r=n.call(this)||this;return r[F]=null!==(t=r[F])&&void 0!==t?t:[],r[e]=!0,r[D]=new H(r),r}return t(o,n),o.prototype.initProvider=function(n){this[G]=n,this[D].start(),this[D].finish()},o.prototype.RefreshContext=function(){this[G]&&this[G]()},o.prototype.waitForAsync=function(n){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:this[D].finish(!0,!1),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n];case 2:return[2,t.sent()];case 3:return this[D].start(!1),[7];case 4:return[2]}})})},o}(k);function K(){return function(n,t){var r,i=n;i[F]=null!==(r=i[F])&&void 0!==r?r:[],i[F].push(t)}}var L=function(n,t){return r(void 0,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),[4,t];case 1:return[2,r.sent()];case 2:return n[D].finish(),[7];case 3:return[2]}})})},N=function(n){return n&&"function"==typeof n.then};function Q(){return function(n,t,r){var i=r.value;r.value=function(n){this[D].start();var t=!1;try{var r=i.call(this,n);return(t=N(r))?L(this,r):r}finally{t||this[D].finish()}}}}var T=function(n){var t=n.services,r=n.children,i=n.deps,o=l(q.apply(void 0,t)(function(){return r}),null!=i?i:[]);return s(o)};export{k as InjectedService,w as inject,q as provider,z as registerIn,w as Inject,q as Provider,z as RegisterIn,O as toClass,R as toExisting,x as toFactory,I as toValue,B as useInstance,C as useInstances,J as ImmutableService,Q as action,K as store,T as ComponentWithServices};
//# sourceMappingURL=index.esm.min.js.map
