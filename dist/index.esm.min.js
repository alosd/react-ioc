import"reflect-metadata";import n from"hoist-non-react-statics";import{Component as t,createContext as r,createElement as i,useContext as o,useRef as u}from"react";import{__extends as e,__awaiter as f,__generator as c}from"tslib";import{createDraft as s,finishDraft as a,immerable as v}from"immer";export{original,enableES5,enableMapSet}from"immer";function h(n){return"function"==typeof n}function l(n){return n&&"object"==typeof n}var d="function"==typeof Symbol?Symbol():"__injector__",m=r({}),b=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return e(t,n),t}(t);function y(n){var t,r=n[d];return r||((r=p||(null===(t=n.context)||void 0===t?void 0:t.injector))instanceof b?(n[d]=r,r):void 0)}var p=null;function _(n,t){for(S.length>0&&(S.forEach(function(n){n()}),S.length=0);n;){var r=n.t.get(t);if(void 0!==r)return r;var i=n.i.get(t);if(i){var o=p;p=n;try{r=i(n)}finally{p=o}return n.t.set(t,r),r}n=n.o}}var S=[];function j(n,t){if(h(t))return w(n,t);var r=n;return t?i(r,t):i;function i(n,t){n.constructor.contextType=m,r||(r=Reflect.getMetadata("design:type",n,t));var i={configurable:!0,enumerable:!0,get:function(){var n=w(this,r);return Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n}),n},set:function(n){Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n})}};return Object.defineProperty(n,t,i),i}}function w(n,t){return _(y(n),t)}var g="function"==typeof Symbol?Symbol():"__binding__";function M(n){return R(function(t){var r=new n;return r[d]||(r[d]=t),r})}function O(n,t){return R(t?function(r){return t.apply(void 0,n.map(function(n){return _(r,n)}))}:n)}function x(n){return R(function(){return n})}function I(n){return R(function(t){return _(t,n)})}function R(n){return n[g]=!0,n}function A(n,t){t.forEach(function(t){var r,i,o;Array.isArray(t)?(i=t[0],o=void 0===(r=t[1])?i:r):i=o=t,n.set(i,o[g]?o:M(o))})}var E=function(){return function(){}}(),P=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r){var o=new Map;A(o,t);var u=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.o=t.context,t.i=o,t.t=new Map,t}return e(t,n),t.prototype.componentDidMount=function(){var n=this;this.t.forEach(function(t){t instanceof E&&t.initProvider(function(){return n.setState({injector:n})})})},t.prototype.componentWillUnmount=function(){this.t.forEach(function(n){l(n)&&h(n.dispose)&&n.dispose()})},t.prototype.render=function(){return i(m.Provider,{value:{injector:this}},i(r,this.props))},t.register=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];A(o,n)},t.WrappedComponent=r,t}(b);return u.contextType=m,n(u,r)}},k=function(n,t){return function(r){return S.push(function(){n().register(t?[r,t]:r)}),r}};function q(n){var t,r=u(void 0),i=null===(t=o(m))||void 0===t?void 0:t.injector;return r.current||(r.current=_(i,n))}function z(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=u(null),e=null===(n=o(m))||void 0===n?void 0:n.injector;return i.current||(i.current=t.map(function(n){return _(e,n)}))}var B="function"==typeof Symbol?Symbol():"__store__",C="function"==typeof Symbol?Symbol():"__stores__",D="function"==typeof Symbol?Symbol():"__refresh__",F=function(){function n(n){this.count=0,this.service=n}return n.prototype.start=function(n){var t,r=this;if(void 0===n&&(n=!0),0==this.count){var i=this.draft=null!==(t=this.draft)&&void 0!==t?t:s(this.service);this.service[C].forEach(function(n){r.service[n]=i[n]})}n&&this.count++},n.prototype.finish=function(n,t){var r=this;if(void 0===n&&(n=!0),void 0===t&&(t=!0),0==this.count)console.warn("the finish method must be called after corresponding start method");else if(t&&this.count--,0==this.count){var i=this.draft;if(i){this.service[C].forEach(function(n){i[n]=r.service[n]});var o=a(i);this.service[C].forEach(function(n){r.service[n]=o[n]}),this.draft=void 0}}n&&this.service.RefreshContext()},n}(),G=function(n){function t(){var t,r=n.call(this)||this;return r[C]=null!==(t=r[C])&&void 0!==t?t:[],r[v]=!0,r[B]=new F(r),r}return e(t,n),t.prototype.initProvider=function(n){this[D]=n,this[B].start(),this[B].finish()},t.prototype.RefreshContext=function(){this[D]&&this[D]()},t.prototype.waitForAsync=function(n){return f(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:this[B].finish(!0,!1),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n];case 2:return[2,t.sent()];case 3:return this[B].start(!1),[7];case 4:return[2]}})})},t}(E);function H(){return function(n,t){var r,i=n;i[C]=null!==(r=i[C])&&void 0!==r?r:[],i[C].push(t)}}var J=function(n,t){return f(void 0,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),[4,t];case 1:return[2,r.sent()];case 2:return n[B].finish(),[7];case 3:return[2]}})})},K=function(n){return n&&"function"==typeof n.then};function L(){return function(n,t,r){var i=r.value;r.value=function(n){this[B].start();var t=!1;try{var r=i.call(this,n);return(t=K(r))?J(this,r):r}finally{t||this[B].finish()}}}}export{E as InjectedService,j as inject,P as provider,k as registerIn,j as Inject,P as Provider,k as RegisterIn,M as toClass,I as toExisting,O as toFactory,x as toValue,q as useInstance,z as useInstances,G as ImmutableService,L as action,H as store};
//# sourceMappingURL=index.esm.min.js.map
