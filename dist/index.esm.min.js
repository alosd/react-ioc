import"reflect-metadata";import n from"hoist-non-react-statics";import{Component as t,createContext as r,createElement as i,useContext as o,useRef as u}from"react";import{__extends as e,__awaiter as f,__generator as c}from"tslib";import{createDraft as s,finishDraft as a,immerable as v}from"immer";export{original,enableES5,enableMapSet}from"immer";function h(n){return"function"==typeof n}function l(n){return n&&"object"==typeof n}var m="function"==typeof Symbol?Symbol():"__injector__",d=r({}),b=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return e(t,n),t}(t);function y(n){var t,r=n[m];return r||((r=_||(null===(t=n.context)||void 0===t?void 0:t.injector))instanceof b?(n[m]=r,r):void 0)}var _=null;function p(n,t){for(S.length>0&&(S.forEach(function(n){n()}),S.length=0);n;){var r=n.t.get(t);if(void 0!==r)return r;var i=n.i.get(t);if(i){var o=_;_=n;try{r=i(n)}finally{_=o}return n.t.set(t,r),n.o(r),r}n=n.u}}var S=[];function j(n,t){if(h(t))return w(n,t);var r=n;return t?i(r,t):i;function i(n,t){n.constructor.contextType=d,r||(r=Reflect.getMetadata("design:type",n,t));var i={configurable:!0,enumerable:!0,get:function(){var n=w(this,r);return Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n}),n},set:function(n){Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n})}};return Object.defineProperty(n,t,i),i}}function w(n,t){return p(y(n),t)}var g="function"==typeof Symbol?Symbol():"__binding__";function M(n){return R(function(t){var r=new n;return r[m]||(r[m]=t),r})}function O(n,t){return R(t?function(r){return t.apply(void 0,n.map(function(n){return p(r,n)}))}:n)}function x(n){return R(function(){return n})}function I(n){return R(function(t){return p(t,n)})}function R(n){return n[g]=!0,n}function A(n,t){t.forEach(function(t){var r,i,o;Array.isArray(t)?(i=t[0],o=void 0===(r=t[1])?i:r):i=o=t,n.set(i,o[g]?o:M(o))})}var E="function"==typeof Symbol?Symbol():"__init__",P=function(){return function(){}}(),k=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return function(r){var o=new Map;A(o,t);var u=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t.u=t.context,t.i=o,t.t=new Map,t}return e(t,n),t.prototype.o=function(n){var t=this;n instanceof P&&!n[E]&&(n.initProvider(function(){return t.setState({injector:t})}),n[E]=!0)},t.prototype.componentDidMount=function(){var n=this;this.t.forEach(function(t){n.o(t)})},t.prototype.componentWillUnmount=function(){this.t.forEach(function(n){l(n)&&h(n.dispose)&&n.dispose()})},t.prototype.render=function(){return i(d.Provider,{value:{injector:this}},i(r,this.props))},t.register=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];A(o,n)},t.WrappedComponent=r,t}(b);return u.contextType=d,n(u,r)}},q=function(n,t){return function(r){return S.push(function(){n().register(t?[r,t]:r)}),r}};function z(n){var t,r=u(void 0),i=null===(t=o(d))||void 0===t?void 0:t.injector;return r.current||(r.current=p(i,n))}function B(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=u(null),e=null===(n=o(d))||void 0===n?void 0:n.injector;return i.current||(i.current=t.map(function(n){return p(e,n)}))}var C="function"==typeof Symbol?Symbol():"__store__",D="function"==typeof Symbol?Symbol():"__stores__",F="function"==typeof Symbol?Symbol():"__refresh__",G=function(){function n(n){this.count=0,this.service=n}return n.prototype.start=function(n){var t,r=this;if(void 0===n&&(n=!0),0==this.count){var i=this.draft=null!==(t=this.draft)&&void 0!==t?t:s(this.service);this.service[D].forEach(function(n){r.service[n]=i[n]})}n&&this.count++},n.prototype.finish=function(n,t){var r=this;if(void 0===n&&(n=!0),void 0===t&&(t=!0),0==this.count)console.warn("the finish method must be called after corresponding start method");else if(t&&this.count--,0==this.count){var i=this.draft;if(i){this.service[D].forEach(function(n){i[n]=r.service[n]});var o=a(i);this.service[D].forEach(function(n){r.service[n]=o[n]}),this.draft=void 0}}n&&this.service.RefreshContext()},n}(),H=function(n){function t(){var t,r=n.call(this)||this;return r[D]=null!==(t=r[D])&&void 0!==t?t:[],r[v]=!0,r[C]=new G(r),r}return e(t,n),t.prototype.initProvider=function(n){this[F]=n,this[C].start(),this[C].finish()},t.prototype.RefreshContext=function(){this[F]&&this[F]()},t.prototype.waitForAsync=function(n){return f(this,void 0,void 0,function(){return c(this,function(t){switch(t.label){case 0:this[C].finish(!0,!1),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n];case 2:return[2,t.sent()];case 3:return this[C].start(!1),[7];case 4:return[2]}})})},t}(P);function J(){return function(n,t){var r,i=n;i[D]=null!==(r=i[D])&&void 0!==r?r:[],i[D].push(t)}}var K=function(n,t){return f(void 0,void 0,void 0,function(){return c(this,function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),[4,t];case 1:return[2,r.sent()];case 2:return n[C].finish(),[7];case 3:return[2]}})})},L=function(n){return n&&"function"==typeof n.then};function N(){return function(n,t,r){var i=r.value;r.value=function(n){this[C].start();var t=!1;try{var r=i.call(this,n);return(t=L(r))?K(this,r):r}finally{t||this[C].finish()}}}}export{P as InjectedService,j as inject,k as provider,q as registerIn,j as Inject,k as Provider,q as RegisterIn,M as toClass,I as toExisting,O as toFactory,x as toValue,z as useInstance,B as useInstances,H as ImmutableService,N as action,J as store};
//# sourceMappingURL=index.esm.min.js.map
