import"reflect-metadata";import n from"hoist-non-react-statics";import{__extends as t,__awaiter as r,__generator as i}from"tslib";import{createDraft as o,finishDraft as u,immerable as e}from"immer";export{original,enableES5,enableMapSet}from"immer";import{Component as f,createContext as c,createElement as s,useContext as a,useRef as v,useCallback as l,Fragment as h}from"react";function d(n){return"function"==typeof n}function m(n){return n&&"object"==typeof n}var b="function"==typeof Symbol?Symbol():"__injector__",y=c({}),_=function(n){function r(){return null!==n&&n.apply(this,arguments)||this}return t(r,n),r}(f);function p(n){var t,r=n[b];return r||((r=S||(null===(t=n.context)||void 0===t?void 0:t.injector))instanceof _?(n[b]=r,r):void 0)}var S=null;function j(n,t){for(w.length>0&&(w.forEach(function(n){n()}),w.length=0);n;){var r=n.t.get(t);if(void 0!==r)return r;var i=n.i.get(t);if(i){var o=S;S=n;try{r=i(n)}finally{S=o}return n.t.set(t,r),n.o(r),r}n=n.u}}var w=[];function g(n,t){if(d(t))return M(n,t);var r=n;return t?i(r,t):i;function i(n,t){n.constructor.contextType=y,r||(r=Reflect.getMetadata("design:type",n,t));var i={configurable:!0,enumerable:!0,get:function(){var n=M(this,r);return Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n}),n},set:function(n){Object.defineProperty(this,t,{enumerable:!0,writable:!0,value:n})}};return Object.defineProperty(n,t,i),i}}function M(n,t){return j(p(n),t)}var O="function"==typeof Symbol?Symbol():"__binding__";function x(n){return E(function(t){var r=new n;return r[b]||(r[b]=t),r})}function I(n,t){return E(t?function(r){return t.apply(void 0,n.map(function(n){return j(r,n)}))}:n)}function R(n){return E(function(){return n})}function A(n){return E(function(t){return j(t,n)})}function E(n){return n[O]=!0,n}function P(n,t){t.forEach(function(t){var r,i,o;Array.isArray(t)?(i=t[0],o=void 0===(r=t[1])?i:r):i=o=t,n.set(i,o[O]?o:x(o))})}var k="function"==typeof Symbol?Symbol():"__init__",q=function(){return function(){}}(),z=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return function(i){var o=new Map;P(o,r);var u=function(n){function r(){var t,r=n.apply(this,arguments)||this;return r.u=null===(t=r.context)||void 0===t?void 0:t.injector,r.i=o,r.t=new Map,r}return t(r,n),r.prototype.o=function(n){var t=this;n instanceof q&&!n[k]&&(n.initProvider(function(){return t.setState({injector:t})}),n[k]=!0)},r.prototype.componentDidMount=function(){var n=this;this.t.forEach(function(t){n.o(t)})},r.prototype.componentWillUnmount=function(){this.t.forEach(function(n){m(n)&&d(n.dispose)&&n.dispose()})},r.prototype.render=function(){return s(y.Provider,{value:{injector:this}},s(i,this.props))},r.register=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];P(o,n)},r.WrappedComponent=i,r}(_);return u.contextType=y,n(u,i)}},B=function(n,t){return function(r){return w.push(function(){n().register(t?[r,t]:r)}),r}};function C(n){var t,r=v(void 0),i=null===(t=a(y))||void 0===t?void 0:t.injector;return r.current||(r.current=j(i,n))}function D(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=v(null),o=null===(n=a(y))||void 0===n?void 0:n.injector;return i.current||(i.current=t.map(function(n){return j(o,n)}))}var F="function"==typeof Symbol?Symbol():"__store__",G="function"==typeof Symbol?Symbol():"__stores__",H="function"==typeof Symbol?Symbol():"__refresh__",J=function(){function n(n){this.count=0,this.service=n}return n.prototype.start=function(n){var t,r=this;if(void 0===n&&(n=!0),0==this.count){var i=this.draft=null!==(t=this.draft)&&void 0!==t?t:o(this.service);this.service[G].forEach(function(n){r.service[n]=i[n]})}n&&this.count++},n.prototype.finish=function(n,t){var r=this;if(void 0===n&&(n=!0),void 0===t&&(t=!0),0==this.count)console.warn("the finish method must be called after corresponding start method");else if(t&&this.count--,0==this.count){var i=this.draft;if(i){this.service[G].forEach(function(n){i[n]=r.service[n]});var o=u(i);this.service[G].forEach(function(n){r.service[n]=o[n]}),this.draft=void 0}}n&&this.service.RefreshContext()},n}(),K=function(n){function o(){var t,r=n.call(this)||this;return r[G]=null!==(t=r[G])&&void 0!==t?t:[],r[e]=!0,r[F]=new J(r),r}return t(o,n),o.prototype.initProvider=function(n){this[H]=n,this[F].start(),this[F].finish()},o.prototype.RefreshContext=function(){this[H]&&this[H]()},o.prototype.waitForAsync=function(n){return r(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:this[F].finish(!0,!1),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,n];case 2:return[2,t.sent()];case 3:return this[F].start(!1),[7];case 4:return[2]}})})},o}(q);function L(){return function(n,t){var r,i=n;i[G]=null!==(r=i[G])&&void 0!==r?r:[],i[G].push(t)}}var N=function(n,t){return r(void 0,void 0,void 0,function(){return i(this,function(r){switch(r.label){case 0:return r.trys.push([0,,2,3]),[4,t];case 1:return[2,r.sent()];case 2:return n[F].finish(),[7];case 3:return[2]}})})},Q=function(n){return n&&"function"==typeof n.then};function T(){return function(n,t,r){var i=r.value;r.value=function(n){this[F].start();var t=!1;try{var r=i.call(this,n);return(t=Q(r))?N(this,r):r}finally{t||this[F].finish()}}}}var U=function(n){var t=n.services,r=n.children,i=n.deps,o=l(z.apply(void 0,t)(function(){return s(h,{},r)}),null!=i?i:[]);return s(o)};export{q as InjectedService,g as inject,z as provider,B as registerIn,g as Inject,z as Provider,B as RegisterIn,x as toClass,A as toExisting,I as toFactory,R as toValue,C as useInstance,D as useInstances,K as ImmutableService,T as action,L as store,U as ComponentWithServices};
//# sourceMappingURL=index.esm.min.js.map
